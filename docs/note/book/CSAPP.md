# 深入理解计算机系统

## 第一章 计算机系统漫游

### 1.1 信息就是位+上下文

1. 系统中的所有信息都是**由一串比特表示的**
2. 区分不同数据的**唯一方法**是读到这些数据时的上下文
    1. 不同的上下文中同样的字节序列可能表示整数、浮点数、字符串...

### 1.2 程序被其他程序翻译成不同的格式

1. 编译系统

   高级语言程序必须被转化为低级机器语言指令才能被系统读懂

    1. 四个阶段
        1. 预处理
            + hello.c --> hello.i(文本)
        2. 编译
            + hello.i --> hello.s(文本)
        3. 汇编
            + hello.s --> hello.o(二进制)
        4. 链接
            + hello.o -hello(二进制)

2. 汇编为不同高级语言的不同编译器提供通用的输出语言

### 1.3 了解编译系统如何工作是大有益处的

1. 优化程序性能
2. 理解链接时出现的错误
3. 避免安全漏洞

### 1.4 处理器读并结束储存在内存中的指令

#### 1.4.1 系统的硬件组成

1. 总线
    1. 贯穿整个系统的**一组电子管道**，携带信息字节并负责在各个部件间传递
    2. 通常被设计成传送定长的字节快，4个字节(32位) 8个字节(64位)
2. I/O设备
    1. 系统与外部世界的联系通道
3. 主存
    1. 临时存储设备
    2. 在处理器执行程序时，存放程序和程序处理的数据
4. 处理器
    1. CPU,解释主存中的指令的引擎
    2. 指令集架构和微体系架构
        1. 指令集架构描述每条机器代码指令的效果
        2. 微体系架构描述处理器实际上是如何实现的

#### 1.4.2 运行hello程序

1. 从键盘读取hello命令
    1. shell将字符读入寄存器，再放到内存
2. 从磁盘加载可执行文件到主存
    1. shell执行指令加载可执行hello文件
    2. 从磁盘复制到主存
3. 将输出字符串从存储器写到显示器
    1. 处理器执行hello程序中的机器指令
    2. 从主存复制到寄存器文件，再从寄存器文件复制到显示设备

### 1.5 高速缓存至关重要

1. 从程序员的角度看，**复制就是开销**
2. 较大的存储设备要比较小的存储设备运行的慢
3. 利用高速缓存能将程序的性能提高一个数量级

### 1.6 存储设备形成层次结构

1. 在处理器和一个较大较慢的设备之间插入一个更小更快的存储设备已经成为一个普遍的概念
2. 存储器层次结构的主要思想是上一层的存储器作为第一层存储器的高速缓存

### 1.7 操作系统管理硬件

1. 操作系统可以看成是应用程序和硬件之间插入的一层软件

2. 操作系统的两个基本功能

    1. 放置硬件被失控的程序滥用
    2. 向应用程序提供简单一致的机制控制复杂的硬件设备

    + 通过进程、虚拟内存、文件等抽象概念来实现

#### 1.7.1 进程

1. 进程是计算机科学中最重要和最成功的的概念之一
2. 进程是**操作系统对一个正在运行的程序的一种抽象**
3. 上下文
    1. 进程运行所需的所有状态信息
4. 上下文切换
    1. 操作系统通过处理器实现进程之间的交错执行
        1. 保存当前进程的上下文、恢复新进程的上下文，然后将控制权传递到新进程
    2. 何时？
        + 当操作系统决定要把控制权从当前进程转移到某个新进程
5. 内核
    1. 操作系统代码常驻主存的部分
    2. 内核不是一个独立的进程，**是系统管理全部进程所用代码和数据结构的集合**
    3. 进程的转换是由操作系统内核管理

#### 1.7.2 线程

1. 一个进程可以由多个称为线程的执行单元组成
2. 每个线程运行在进程的上下文中
3. 共享同样的代码和全局数据

#### 1.7.3 虚拟内存

1. 是一个抽象概念，为每一个进程提供一个假象：每个进程都在独占使用内存
2. 每个进程看到的内存都是一致的，称为虚拟地址空间
3. 区域划分
    1. 程序代码和数据
    2. 堆
    3. 共享库
    4. 栈
    5. 内核虚拟内存
4. 运作
    1. 虚拟内存运作需要硬件和操作系统软件之间精密复杂的交互
    2. 基本思想是把一个继承虚拟内存的内容存储在磁盘上，然后用主存作为磁盘的高速缓存

#### 1.7.4 文件

1. 文件就是字节序列
    1. 每个IO设备都可以看做是文件，向应用程序提供了一个统一的视图

### 1.8 系统之间利用网络通信

现代系统经常通过网络和其他系统连接到一起

### 1.9 重要主题

#### 1.9.1 Amdahl定律

1. 要想加速整个系统，必须提升全系统中相当大的部分的速度

#### 1.9.2 并发和并行

1. 并发指同时具有多个活动的系统
2. 并行指用并发来使一个系统运行的更快
3. 三个层次
    1. 线程级并发
    2. 指令级并行
    3. 单指令、多数据并行

#### 1.9.3 计算机系统中抽象的重要性

1. 文件：对IO的抽象
2. 虚拟内存：对程序存储器的抽象
3. 进程：对正在运行的程序的抽象
4. 虚拟机：对整个计算机的抽象
